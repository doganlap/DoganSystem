@model DoganSystem.Modules.Subscription.Application.Dtos.SubscriptionDto
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<DoganSystem.Localization.GrcResource> L
@{
    ViewData["Title"] = L["Subscription:SubscriptionDetails"];
}

<div class="container">
    <div class="row">
        <div class="col-md-8">
            <h2>@L["Subscription:SubscriptionDetails"]</h2>
            <div class="card">
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">@L["Tenant:TenantId"]:</dt>
                        <dd class="col-sm-9">@Model.TenantId</dd>

                        <dt class="col-sm-3">@L["Subscription:PlanType"]:</dt>
                        <dd class="col-sm-9">@Model.PlanType</dd>

                        <dt class="col-sm-3">@L["Common:Status"]:</dt>
                        <dd class="col-sm-9">
                            <span class="badge bg-@(Model.Status == "Active" ? "success" : "warning")">
                                @Model.Status
                            </span>
                        </dd>

                        <dt class="col-sm-3">@L["Subscription:MonthlyPrice"]:</dt>
                        <dd class="col-sm-9">@Model.MonthlyPrice.ToString("C")</dd>

                        <dt class="col-sm-3">@L["Subscription:StartDate"]:</dt>
                        <dd class="col-sm-9">@Model.StartDate.ToString("yyyy-MM-dd")</dd>

                        <dt class="col-sm-3">@L["Subscription:EndDate"]:</dt>
                        <dd class="col-sm-9">@(Model.EndDate?.ToString("yyyy-MM-dd") ?? L["Common:NotAvailable"])</dd>

                        <dt class="col-sm-3">@L["Subscription:NextBilling"]:</dt>
                        <dd class="col-sm-9">@(Model.NextBillingDate?.ToString("yyyy-MM-dd") ?? L["Common:NotAvailable"])</dd>

                        <dt class="col-sm-3">@L["Subscription:PaymentProvider"]:</dt>
                        <dd class="col-sm-9">@(Model.PaymentProvider ?? L["Common:NotAvailable"])</dd>
                    </dl>

                    <div class="mt-3">
                        @if (Model.Status == "Active")
                        {
                            <button class="btn btn-warning" onclick="cancelSubscription('@Model.Id')">@L["Subscription:CancelSubscription"]</button>
                        }
                        else
                        {
                            <button class="btn btn-success" onclick="renewSubscription('@Model.Id')">@L["Subscription:RenewSubscription"]</button>
                        }
                        <a href="/Subscriptions" class="btn btn-secondary">@L["Common:BackToList"]</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        async function cancelSubscription(id) {
            if (confirm('@L["Subscription:CancelConfirmMessage"]')) {
                await fetch(`/api/subscriptions/${id}/cancel`, { method: 'POST' });
                location.reload();
            }
        }

        async function renewSubscription(id) {
            await fetch(`/api/subscriptions/${id}/renew`, { method: 'POST' });
            location.reload();
        }
    </script>
}
