@using Microsoft.Extensions.Localization
@inject IStringLocalizer<DoganSystem.Localization.GrcResource> L
@{
    ViewData["Title"] = L["Dashboard:Title"];
}

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 mb-2">@L["Dashboard:Title"]</h1>
            <p class="text-muted">@L["Dashboard:WelcomeMessage"]</p>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="bg-primary bg-opacity-10 rounded-3 p-3">
                                <i class="fas fa-building fa-2x text-primary"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="text-muted mb-1">@L["Menu:Tenants"]</h6>
                            <h3 class="mb-0" id="tenantCount">-</h3>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="/Tenants" class="btn btn-sm btn-outline-primary">@L["Common:Manage"]</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="bg-success bg-opacity-10 rounded-3 p-3">
                                <i class="fas fa-database fa-2x text-success"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="text-muted mb-1">@L["Menu:ErpNext"]</h6>
                            <h3 class="mb-0" id="erpnextCount">-</h3>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="/ErpNext" class="btn btn-sm btn-outline-success">@L["Common:Manage"]</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="bg-info bg-opacity-10 rounded-3 p-3">
                                <i class="fas fa-robot fa-2x text-info"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="text-muted mb-1">@L["Menu:Agents"]</h6>
                            <h3 class="mb-0" id="agentCount">-</h3>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="/Agents" class="btn btn-sm btn-outline-info">@L["Common:Manage"]</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="bg-warning bg-opacity-10 rounded-3 p-3">
                                <i class="fas fa-credit-card fa-2x text-warning"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="text-muted mb-1">@L["Menu:Subscriptions"]</h6>
                            <h3 class="mb-0" id="subscriptionCount">-</h3>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="/Subscriptions" class="btn btn-sm btn-outline-warning">@L["Common:Manage"]</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2 text-primary"></i>@L["Dashboard:QuickActions"]</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-auto">
                            <a href="/Tenants/Create" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>@L["Tenant:CreateTenant"]
                            </a>
                        </div>
                        <div class="col-auto">
                            <a href="/Agents/Create" class="btn btn-info text-white">
                                <i class="fas fa-robot me-2"></i>@L["Agent:CreateAgent"]
                            </a>
                        </div>
                        <div class="col-auto">
                            <a href="/ErpNext/Create" class="btn btn-success">
                                <i class="fas fa-database me-2"></i>@L["ErpNext:AddInstance"]
                            </a>
                        </div>
                        <div class="col-auto">
                            <a href="/swagger" class="btn btn-secondary" target="_blank">
                                <i class="fas fa-code me-2"></i>@L["Dashboard:ApiDocs"]
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Platform Modules -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="mb-0"><i class="fas fa-th-large me-2 text-primary"></i>@L["Dashboard:PlatformModules"]</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4 col-lg-3">
                            <a href="/frameworks" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light hover-shadow">
                                    <i class="fas fa-sitemap fa-2x text-primary mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Frameworks"]</h6>
                                    <small class="text-muted">@L["Dashboard:FrameworksDesc"]</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <a href="/assessments" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light">
                                    <i class="fas fa-clipboard-check fa-2x text-success mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Assessments"]</h6>
                                    <small class="text-muted">@L["Dashboard:AssessmentsDesc"]</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <a href="/risks" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light">
                                    <i class="fas fa-exclamation-triangle fa-2x text-warning mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Risks"]</h6>
                                    <small class="text-muted">@L["Dashboard:RisksDesc"]</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <a href="/audits" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light">
                                    <i class="fas fa-search fa-2x text-info mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Audits"]</h6>
                                    <small class="text-muted">@L["Dashboard:AuditsDesc"]</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <a href="/policies" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light">
                                    <i class="fas fa-file-alt fa-2x text-secondary mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Policies"]</h6>
                                    <small class="text-muted">@L["Dashboard:PoliciesDesc"]</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <a href="/vendors" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light">
                                    <i class="fas fa-handshake fa-2x text-primary mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Vendors"]</h6>
                                    <small class="text-muted">@L["Dashboard:VendorsDesc"]</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <a href="/reports" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light">
                                    <i class="fas fa-chart-bar fa-2x text-danger mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Reports"]</h6>
                                    <small class="text-muted">@L["Dashboard:ReportsDesc"]</small>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-4 col-lg-3">
                            <a href="/integrations" class="text-decoration-none">
                                <div class="border rounded-3 p-3 h-100 bg-light">
                                    <i class="fas fa-plug fa-2x text-success mb-2"></i>
                                    <h6 class="mb-1">@L["Menu:Integrations"]</h6>
                                    <small class="text-muted">@L["Dashboard:IntegrationsDesc"]</small>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        async function loadDashboard() {
            try {
                const [tenants, erpnext, agents, subscriptions] = await Promise.all([
                    fetch('/api/tenants?MaxResultCount=1').then(r => r.json()).catch(() => ({ totalCount: 0 })),
                    fetch('/api/erpnext?MaxResultCount=1').then(r => r.json()).catch(() => ({ totalCount: 0 })),
                    fetch('/api/agents?MaxResultCount=1').then(r => r.json()).catch(() => ({ totalCount: 0 })),
                    fetch('/api/subscriptions?MaxResultCount=1').then(r => r.json()).catch(() => ({ totalCount: 0 }))
                ]);

                document.getElementById('tenantCount').textContent = tenants.totalCount || 0;
                document.getElementById('erpnextCount').textContent = erpnext.totalCount || 0;
                document.getElementById('agentCount').textContent = agents.totalCount || 0;
                document.getElementById('subscriptionCount').textContent = subscriptions.totalCount || 0;
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('tenantCount').textContent = '0';
                document.getElementById('erpnextCount').textContent = '0';
                document.getElementById('agentCount').textContent = '0';
                document.getElementById('subscriptionCount').textContent = '0';
            }
        }

        loadDashboard();
    </script>
}
